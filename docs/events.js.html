<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>events.js - Documentation</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Tutorials</li><li class="nav-item"><a href="tutorial-developer-guide.html">Developer Guide</a></li><ol class="nav-tut-list"><li class="nav-item"><a href="tutorial-installation.html">Installation</a></li><li class="nav-item"><a href="tutorial-api-overview.html">API Overview</a></li><li class="nav-item"><a href="tutorial-events-oracles-and-markets.html">Events, Oracles, and Markets</a></li><li class="nav-item"><a href="tutorial-lmsr-primer.html">LMSR Primer</a></li></ol><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Gnosis.html">Gnosis</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#.calcLMSRCost">calcLMSRCost</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#.calcLMSRMarginalPrice">calcLMSRMarginalPrice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#.calcLMSROutcomeTokenCount">calcLMSROutcomeTokenCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#.calcLMSRProfit">calcLMSRProfit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#.create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#.requireEventFromTXResult">requireEventFromTXResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#buyOutcomeTokens">buyOutcomeTokens</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#createCategoricalEvent">createCategoricalEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#createCentralizedOracle">createCentralizedOracle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#createMarket">createMarket</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#createScalarEvent">createScalarEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#createUltimateOracle">createUltimateOracle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#loadEventDescription">loadEventDescription</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#publishEventDescription">publishEventDescription</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#resolveEvent">resolveEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#sellOutcomeTokens">sellOutcomeTokens</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gnosis.html#setWeb3Provider">setWeb3Provider</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">events.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import _ from 'lodash'
import { wrapWeb3Function, normalizeWeb3Args, requireEventFromTXResult } from './utils'

/**
 * Creates a categorical event.
 *
 * Note: this method is asynchronous and will return a Promise
 *
 * @function
 * @param {(Contract|string)} opts.collateralToken - The collateral token contract or its address
 * @param {(Contract|string)} opts.oracle - The oracle responsible for resolving this event
 * @param {(number|string|BigNumber)} opts.outcomeCount - The number of outcomes of this event
 * @returns {Contract} The created categorical event
 * @alias Gnosis#createCategoricalEvent
 */
export const createCategoricalEvent = wrapWeb3Function((self) => ({
    callerContract: self.contracts.EventFactory,
    methodName: 'createCategoricalEvent',
    eventName: 'CategoricalEventCreation',
    eventArgName: 'categoricalEvent',
    resultContract: self.contracts.CategoricalEvent
}))

/**
 * Creates a scalar event.
 *
 * Note: this method is asynchronous and will return a Promise
 *
 * @function
 * @param {(Contract|string)} opts.collateralToken - The collateral token contract or its address
 * @param {(Contract|string)} opts.oracle - The oracle responsible for resolving this event
 * @param {(number|string|BigNumber)} opts.lowerBound - The lower bound for the event outcome
 * @param {(number|string|BigNumber)} opts.upperBound - The upper bound for the event outcome
 * @returns {Contract} The created scalar event
 * @alias Gnosis#createScalarEvent
 */
export const createScalarEvent = wrapWeb3Function((self) => ({
    callerContract: self.contracts.EventFactory,
    methodName: 'createScalarEvent',
    eventName: 'ScalarEventCreation',
    eventArgName: 'scalarEvent',
    resultContract: self.contracts.ScalarEvent
}))

/**
 * Publishes an event description onto IPFS.
 *
 * Note: this method is asynchronous and will return a Promise
 *
 * @param {Object} eventDescription - A POD object describing the event
 * @param {string} eventDescription.title - A string describing the title of the event
 * @param {string} eventDescription.description - A string describing the purpose of the event
 * @param {string} eventDescription.resolutionDate - A string containing the resolution date of the event
 * @param {string[]} eventDescription.outcomes - A string array containing the outcomes of the event
 * @returns {string} The IPFS hash locating the published event
 * @alias Gnosis#publishEventDescription
 */
export async function publishEventDescription (description) {
    const resultHash = await this.ipfs.addJSONAsync(description)
    this.log(`published event description on IPFS at ${resultHash}`)
    return resultHash
}

/**
 * Loads an event description from IPFS.
 *
 * Note: this method is asynchronous and will return a Promise
 *
 * @param {string} ipfsHash - The IPFS hash locating the published event
 * @returns {Object} A POD object describing the event
 * @alias Gnosis#loadEventDescription
 */
export async function loadEventDescription (ipfsHash) {
    return await this.ipfs.catJSONAsync(ipfsHash)
}

/**
 * Resolves an event. Assumes event is backed solely by a centralized oracle controlled by you
 *
 * Note: this method is asynchronous and will return a Promise
 *
 * @param {(Contract|string)} opts.event - The event address or instance
 * @param {(number|string|BigNumber)} opts.outcome - The outcome to set this event to. This is the zero-based index of the outcome for categorical events and the decimals-adjusted value of the outcome for scalar events.
 * @alias Gnosis#resolveEvent
 */
export async function resolveEvent() {
    const [[eventAddress, outcome], opts] =
        normalizeWeb3Args(Array.from(arguments), {
            methodName: 'resolveEvent',
            functionInputs: [
                { name: 'event', type: 'address' },
                { name: 'outcome', type: 'int256'},
            ]
        })

    const event = await this.contracts.Event.at(eventAddress)
    const oracle = await this.contracts.CentralizedOracle.at(await event.oracle(opts))
    requireEventFromTXResult(await oracle.setOutcome(outcome, opts), 'OutcomeAssignment')
    requireEventFromTXResult(await event.setOutcome(opts), 'OutcomeAssignment')
}

resolveEvent.estimateGas = async function({ using }) {
    if(using === 'stats') {
        return this.contracts.CentralizedOracle.gasStats.setOutcome.averageGasUsed +
            this.contracts.Event.gasStats.setOutcome.averageGasUsed
    }
    throw new Error(`unsupported gas estimation source ${using}`)
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Feb 23 2018 17:47:12 GMT+0100 (CET) using the Minami theme.
</footer>

<script>hljs.initHighlightingOnLoad();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
